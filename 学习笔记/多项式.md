# 多项式
$n$次多项式表示为 $f(x)=a_0x^0+a_1x^1+a_2x^2+\cdots+a_{n-1}x^{n-1}$
$n$次多项式的两种表示法：
1. 系数表示：{$a_0, a_1, a_2, \cdots， a_{n-1}$}
2. 点值表示：{$x_0, x_1, x_2, \cdots， x_{n-1}$}

$n$个点值可以唯一第表示有$n$个系数的多项式
两者可以互相转化

# 多项式乘法
结果每一项有$c_k=\displaystyle\sum_{i=0}^n\sum_{j=0}^na_ib_j[i+j=k]=\sum_{i=0}^ka_ib_{k-i}$
后者就是卷积形式
写成$h(k)=\displaystyle\sum_{x=0}^kf(x)*g(k-x)$
所以对于数组的这种形式公式，便可用多项式求解

## DFT(离散傅里叶变换)
将多项式系数表示转化为点值表示。
### FFT(快速傅里叶变换)
用$O(\log n)$的复杂度将多项式系数表示转化为点值表示。
**原理：**
一个$n=2^k$次多项式$A(x)=a_0x^0+a_1x^1+a_2x^2+\cdots+a_{n-1}x^{n-1}$可以写为
$$
\begin{aligned}
    A(x) &= a_0x^0+a_1x^1+a_2x^2+\cdots+a_{n-1}x^{n-1}\\
    &= (a_0x^0+a_2x^2+\cdots+a_{n-2}x^{n-2})+(a_1x^1+a_3x^3+\cdots+a_{n-1}x^{n-1})\\
    &=(a_0x^0+a_2x^2+\cdots+a_{n-2}x^{n-2})+x(a_1x^0+a_3x^2+\cdots+a_{n-1}x^{n-2})\\
    &=A_1(x^2)+xA_2(x^2)
\end{aligned}
$$

这里将具有对称性质的单位根代入进去的话
$$
代入w_n^k\\
\begin{aligned}
    A(w_n^k) &= A_1(w_n^{2k})+w_n^kA_2(w_n^{2k})\\
    &=A_1(w_\frac{n}{2}^k)+w_n^kA_2(w_\frac{n}{2}^k)
\end{aligned}
$$
$$
代入w_n^{k+\frac{n}{2}}\\
\begin{aligned}
    A(w_n^{k+\frac{n}{2}}) &= A_1(w_n^{2k+n})+w_n^{k+\frac{n}{2}}A_2(w_n^{2k+n})\\
    &=A_1(w_\frac{n}{2}^k)-w_n^kA_2(w_\frac{n}{2}^k)
\end{aligned}
$$
如上所见，只要代入多项式次数$n$一半的点就可以得到2倍的对应的点值。接着在求解点值时同理递归计算$A_1,A_2$的点值即可。

**单位根**
在计算点值时为了使代入数值具有对称性，要找到所有$\pm x, \pm x^{\frac{1}{2}}, \pm x^{\frac{1}{4}}, \cdots, \pm x^{\frac{1}{2^k}}$,此时引入单位根。
$w_n$为$n$次单位根，有$(w_n)^n=w_n^n=1$和$w_n^{k+\frac{n}{2}}=-w_n^k$的性质。(在复数域上做单位圆来做理解)
根据欧拉公式$e^{ix}=cos(x)+isin(x)$得$w_n^n=cos(\frac{2\pi n}{n})+isin(\frac{2\pi n}{n})=1$
所以$k$次单位根表示为$w_n^k=cos(\frac{2\pi k}{n})+isin(\frac{2\pi k}{n})$ 

# 原根
用数论的单位根代替复数的单位根

映射到实数域上即为单位根$x^n=1$
在定义前先引入**阶**的概念：满足$a^x\equiv 1(mod\space m)$的$x$最小,则$x$为：$a$模$m$的**阶**,$x=\delta_m(a)$
**定义：** 若$gcd(x, n)=1$且,$\delta_m(x)=\varphi(n)$。
则$x$为$n$的原根

## 重要性质
+ 原根判定定理, $m>=3, gcd(x, m)=1$,若$x$为原根，对$\varphi(m)$的所以素因数$p$有：$x^{\frac{\varphi(m)}{p}}\not\equiv 1(mod\space m)$
+ 原根个数：若$m$有原根，则其原根个数为$\varphi(\varphi(m))$
+ 原根存在定理：当且仅当$n=2, 4, p^a, 2p^a$时其原根存在。其中$p$为奇素数。
+ 最小原根的数量级：若有n原根，则不超过$n^{0.25=\frac{1}{4}}$

## 求原根
1. 先判断是否有原根
2. 暴力找最小原根
3. 若$g$为最小原根，则原根判定定理成立，以此判断即可
复杂度为$O(n^{0.25}\log n)$

#### 递归法的代码示例
表达思想，未经过正确性验证
```C++
//a多项式系数数组，len=2^k,complex复数
void fft(std::vector<complex> a, int len){
    //定义两部分的数组
    std::vector<complex> a1(len/2), a2(len/2);
    //第一步：对多项式系数奇偶划分
    for (int i=0; i<len; i++){
        a1[i*2]=a[i];
        a2[i*2+1]=a[i];
    }
    //第二步：递归计算两部分的点值
    fft(a1, len/2);
    fft(a2, len/2);
    //第三步：代入单位根的k次幂
    //w_n单位根，w当前的k次幂
    complex w_n=complex(cos(2*PI/len), sin(2*PI/len));
    complex w=complex(1, 0);
    //第四步：利用两部分的w_(n/2)^k的点值计算自己的点值.
    for (int i=0; i<(len/2); i++, w=w*w_n){
        a[i]=a1[i]+w*a2[i];
        a[i+(len/2)]=a1[i]-w*a2[i];
    }
}
```
**一些优化**
注意到多项式系数递归进行奇偶划分后的系数关系
0, 1, 2, 3, 4, 5, 6, 7
0, 4, 2, 6, 1, 5, 3, 7
二进制表示为
000, 001, 010, 011, 100, 101, 110, 111
000, 100, 010, 110, 001, 101, 011, 111
发现变化前后的数是他们二进制表示的对应位数的二进制反转。
所以我们FFT时可以将递归转为递推。

```C++
template <class T>
constexpr void dft(std::vector<T> &a){
    int n=a.size();

    if (int(rev.size()) != n) {
        int k = __builtin_ctz(n) - 1;
        rev.resize(n);
        //利用二进制的一半是其二进制右移一位的性质
        //反转后其二进制是其一半反转后右移一位。 最左边的位数为其最右边的位数反转
        for (int i = 0; i < n; i++) {
            rev[i] = rev[i >> 1] >> 1 | (i & 1) << k;
        }
    }

    for (int i = 0; i < n; i++) {
        //只有比其小再交换，防止交换两次回到原来的位置
        if (rev[i] < i) {
            std::swap(a[i], a[rev[i]]);
        }
    }

    for (int k=1; k<n; k*=2){//k合并区间长度的一半

        T w_n(cos(PI/k), sin(PI/k));//单位根

        for (int i=0; i<n; i+=2*k){//i合并区间在整个区间的哪个位置

            T w(1, 0);//当前的幂

            for (int j=0; j<k; j++, w=w*w_n){//j在合并区间的位置
                T x=a[i+j];
                T y=a[i+j+k]*w;
                a[i+j]=x+y;
                a[i+j+k]=x-y;
            }
        }
    }
}
```
## IDFT(离散傅里叶逆变换)
将多项式点值表示转化为系数表示。
### IFFT(快速傅里叶逆变换)
两种实现方法
1. 将要代入的单位根取倒数后再进行FFT，最后所有数除以长度$n$
2. 将数组后$n-1$反转，做一遍FFT后除以长度$n$


### 多项式的导数
对多项式每一项求导即可
$$(a_kx^k)^{'}=ka_kx^{k-1}=a_{k-1}^{'}x^{k-1}$$
所以求导后每一项的系数$a_k^{'}$,$0<=k<n-1$为
$$a_k^{'}=(k+1)a_{k+1}$$
### 多项式的积分
同求导，对多项式每一项积分即可
$$\int a_kx^kdx=\frac{a_k}{k+1}x^{k+1}=a_{k+1}^{'}x^{k+1}$$
所以积分后每一项的系数$a_k^{'}$,$1<=k<=n$为
$$a_k^{'}=\frac{a_{k-1}}{k}$$

